version: '3.7'
services:
  web-app:
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 2G
        reservations:
          memory: 2G
    environment:
      EMAIL_SENDER_USERNAME: "some.user@somedomain.com"
      EMAIL_SENDER_PASSWORD: "somepassword"
      EMAIL_SENDER_HOST: "some.smtp.somedomain.com"
      SSL_TRUST_HOST: "bogus"
      AUTOMATED_HIT_NOTIFICATION_EMAIL_ENABLED: "false"
      MANUAL_HIT_NOTIFICATION_EMAIL_ENABLED: "false"
      ADDITIONAL_PROCESSING_THIRD_PARTY: "false"
      ADDITIONAL_PROCESSING_RAW: "false"
      ADDITIONAL_PROCESSING_RULES: "false"
      UI_ADDRESS: localhost
      DB_HOST: mariadb      
  rule-runner:
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 1G
        reservations:
          memory: 1G
    environment:
      MARIA_URL: mariadb
      DB_HOST: mariadb
      MARIA_USERNAME: root
      MARIA_PASSWORD: admin
      UI_ADDRESS: localhost
      ACTIVE_MQ_HOST: activemq
  activemq:
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 500M
        reservations:
          memory: 500M
    ports:
      - 61616:61616
      - 8161:8161      
  gtas-scheduler:
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 1G
        reservations:
          memory: 1G
    environment:
      EMAIL_SENDER_USERNAME: "some.user@somedomain.com"
      EMAIL_SENDER_PASSWORD: "somepassword"
      EMAIL_SENDER_HOST: "some.smtp.somedomain.com"
      SSL_TRUST_HOST: "bogus"
      AUTOMATED_HIT_NOTIFICATION_EMAIL_ENABLED: "false"
      MANUAL_HIT_NOTIFICATION_EMAIL_ENABLED: "true"
      ADDITIONAL_PROCESSING_THIRD_PARTY: "false"
      ADDITIONAL_PROCESSING_RAW: "false"
      ADDITIONAL_PROCESSING_RULES: "false"
      UI_ADDRESS: localhost
    volumes:
      - type: bind
        source: ./gtas-data
        target: /usr/local/gtas-data
        consistency: consistent
  neo4j:
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 1G
        reservations:
          memory: 1G
    environment:
      NEO4J_AUTH: "neo4j/admin"
      NEO4J_dbms_connector_bolt_advertised__address: localhost:7687
      NEO4J_dbms_connectors_default__advertised__address: localhost
  gtas-loader-1:
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 1G
        reservations:
          memory: 1G
    environment:
      MARIA_URL: mariadb
      MARIA_USERNAME: root
      MARIA_PASSWORD: admin
      ACTIVE_MQ_HOST: activemq
    volumes:
      - type: bind
        source: ./gtas-data
        target: /usr/local/gtas-data
        consistency: consistent 
  elasticsearch:
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 2G
        reservations:
          memory: 2G
  logstash:
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 1G
        reservations:
          memory: 1G
  kibana:
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 500M
        reservations:
          memory: 500M
  mariadb:
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 2G
        reservations:
          memory: 2G
  etl-job:
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 1G
        reservations:
          memory: 1G
secrets:
  kibana-crt:
    file: ./gtas-parent/gtas-commons/certs/kibana.crt
  kibana-key:
    file: ./gtas-parent/gtas-commons/certs/kibana.key
